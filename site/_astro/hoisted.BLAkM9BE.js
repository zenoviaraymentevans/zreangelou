import"./hoisted.DrPFa1Qe.js";import{d as c}from"./player.CKjfIk3N.js";import{$ as n}from"./store.aycOQVLs.js";const p=o=>{o.classList.add("hidden"),o.classList.remove("flex")},y=o=>{o.classList.add("flex"),o.classList.remove("hidden")},m="!bg-blue-hover",b=document.querySelectorAll(".playAnnotation");for(let o=0;o<b.length;o++){const s=b[o];if(s.dataset.start&&s.dataset.playerId){const e=n.get()[s.dataset.playerId]?.annotationStarts;e&&(e.push({start:Math.floor(Number(s.dataset.start)),end:Math.floor(Number(s.dataset.end))>Math.floor(Number(s.dataset.start))?Math.floor(Number(s.dataset.end)):void 0,playerId:s.dataset.playerId}),n.setKey(s.dataset.playerId,{...n.get()[s.dataset.playerId]||c,annotationStarts:e})),s.addEventListener("click",()=>{const a=s.dataset.playerId||"null";n.setKey(a,{...n.get()[a]||c,position:Number(s.dataset.start),seekTo:Number(s.dataset.start),isPlaying:!0})})}}n.listen((o,s,e)=>{if(!e)return null;const a=document.querySelector(`.eventContainer[data-player-id="${e}"]`);if(!a)return console.error(`No event container found for ${e}`),null;const i=a.querySelectorAll(".annotationNode"),l=a.querySelectorAll(".annotationTags"),f=o[e].annotationStarts?.filter(t=>t.playerId===e),d=f?.findIndex((t,r)=>typeof t.end=="number"?t.start<=o[e].position&&t.end>o[e].position:r<f.length-1?t.start<=o[e].position&&f[r+1].start>o[e].position:t.start<=o[e].position);if(typeof d=="number"&&d>=0){const t=i[d];if(t){if(o[e].autoScroll)if(o[e].isEmbed){const r=document.querySelector(`.videoAnnotationContainer[data-player-id="${e}"]`),u=t.offsetTop;r?r.scroll({top:u-r.clientHeight,behavior:"smooth"}):a.scroll({top:u-a.clientHeight/3,behavior:"smooth"})}else t.scrollIntoView({behavior:"smooth",block:"end"});t.classList.add(m)}for(let r=0;r<i.length;r++)r!==d&&i[r].classList.remove(m)}if(o[e].showTags!==s[e]?.showTags)if(o[e].showTags)for(let t=0;t<l.length;t++)y(l[t]);else for(let t=0;t<l.length;t++)p(l[t]);for(const t of i){const r=t.getAttribute("data-uuid");r&&o[e].filteredAnnotations.includes(r)?y(t):p(t)}});
