import{j as e}from"./jsx-runtime.CIMolHGP.js";import{u as X}from"./index.bM7OrN6I.js";import{d as q}from"./player.CKjfIk3N.js";import{r,R as y}from"./index.DddtCxX5.js";import{c as z,t as J,b as Q,d as Y,$ as Z}from"./store.aycOQVLs.js";import{F as T}from"./XMarkIcon.FHGgCzxh.js";import{u as ee,a as te,I as se,G as ae,$ as le,b as re}from"./label.CyPQ0yu1.js";import{w as oe}from"./use-active-press.BcMJ0Cf1.js";import{l as ie,T as ne,j as ce,r as de,o as P,p as me,a as ge,A as ue,R as fe}from"./popover.Xb4V8AfL.js";import{p as xe}from"./use-disposables.CSnXTm91.js";import{W as he,o as j,D as pe,H as be}from"./use-sync-refs.CdR1_aZG.js";import"./index.Py3gQaBW.js";import"./use-server-handoff-complete.Cj_Xa9jq.js";import"./floating-ui.react-dom.TQbKx63O.js";function je({title:t,titleId:l,...d},s){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":l},d),t?r.createElement("title",{id:l},t):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 13.5V3.75m0 9.75a1.5 1.5 0 0 1 0 3m0-3a1.5 1.5 0 0 0 0 3m0 3.75V16.5m12-3V3.75m0 9.75a1.5 1.5 0 0 1 0 3m0-3a1.5 1.5 0 0 0 0 3m0 3.75V16.5m-6-9V3.75m0 3.75a1.5 1.5 0 0 1 0 3m0-3a1.5 1.5 0 0 0 0 3m0 9.75V10.5"}))}const we=r.forwardRef(je);function ye({title:t,titleId:l,...d},s){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":l},d),t?r.createElement("title",{id:l},t):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"}))}const N=r.forwardRef(ye);let ke="span";function ve(t,l){let d=r.useId(),s=ee(),k=te(),{id:m=s||`headlessui-checkbox-${d}`,disabled:o=k||!1,autoFocus:a=!1,checked:f,defaultChecked:i,onChange:g,name:n,value:u,form:v,indeterminate:b=!1,...A}=t,x=ie(i),[h,p]=ne(f,g,x??!1),D=se(),V=ae(),I=xe(),[$,C]=r.useState(!1),F=j(()=>{C(!0),p?.(!h),I.nextFrame(()=>{C(!1)})}),M=j(c=>{if(de(c.currentTarget))return c.preventDefault();c.preventDefault(),F()}),O=j(c=>{c.key===P.Space?(c.preventDefault(),F()):c.key===P.Enter&&me(c.currentTarget)}),G=j(c=>c.preventDefault()),{isFocusVisible:E,focusProps:H}=le({autoFocus:a}),{isHovered:S,hoverProps:B}=re({isDisabled:o}),{pressed:R,pressProps:K}=oe({disabled:o}),W=pe({ref:l,id:m,role:"checkbox","aria-checked":b?"mixed":h?"true":"false","aria-labelledby":D,"aria-describedby":V,"aria-disabled":o?!0:void 0,indeterminate:b?"true":void 0,tabIndex:o?void 0:0,onKeyUp:o?void 0:O,onKeyPress:o?void 0:G,onClick:o?void 0:M},H,B,K),_=r.useMemo(()=>({checked:h,disabled:o,hover:S,focus:E,active:R,indeterminate:b,changing:$,autofocus:a}),[h,b,o,S,E,R,$,a]),U=r.useCallback(()=>{if(x!==void 0)return p?.(x)},[p,x]);return y.createElement(y.Fragment,null,n!=null&&y.createElement(ce,{disabled:o,data:{[n]:u||"on"},overrides:{type:"checkbox",checked:h},form:v,onReset:U}),be({ourProps:W,theirProps:A,slot:_,defaultTag:ke,name:"Checkbox"}))}let L=he(ve);const w=t=>/^#[0-9A-F]{6}[0-9a-f]{0,2}$/i.test(t),Ne=t=>{const l=e.jsxs(e.Fragment,{children:[t.icon&&e.jsx(t.icon,{className:"size-4"}),e.jsx("span",{className:"font-semibold",children:t.tag}),t.count?e.jsx("span",{children:t.count}):null]});return t.onClick?e.jsx("button",{className:`${w(t.color)?"":`bg-${t.color}`} tag-pill rounded-full text-xs flex flex-row justify-center px-3 py-1.5 gap-1 cursor-default ${t.className||""}`,style:{backgroundColor:w(t.color)?t.color:void 0},onClick:t.onClick,children:l}):e.jsx("div",{className:`${w(t.color)?"":`bg-${t.color}`} tag-pill rounded-full text-xs flex flex-row justify-center px-3 py-1.5 gap-1 cursor-default ${t.className||""}`,style:{backgroundColor:w(t.color)?t.color:void 0},onClick:t.onClick,children:l})},Me=t=>{const{playerId:l}=t,d=X(Z),s=r.useMemo(()=>d[l]||{...q},[d,l]),k=t.projectData.data.project.tags.tagGroups,m=r.useMemo(()=>{const a={};return(s.sets?.length>0?t.annotationSets.filter(i=>s.sets.includes(i.id)):t.annotationSets).forEach(i=>{i?.data.annotations.forEach(g=>{g.tags&&g.tags.length&&g.tags.forEach(n=>{const u=n.category.toLowerCase();a[u]||={tags:[],color:k.find(v=>v.category.toLowerCase()===u)?.color||"#FFF"},a[u].tags.includes(n.tag)||(a[u].tags.push(n.tag),a[u].tags.sort())})})}),a},[s.sets]),o=Object.keys(m);return e.jsxs(ge,{children:[e.jsxs(ue,{className:"bg-white rounded-lg flex flex-row justify-center items-center gap-2 px-2 py-1.5 data-[open]:bg-blue-hover font-semibold",children:[e.jsx(we,{className:"size-4"}),e.jsx("span",{children:"Filter"}),(s.tags.length>0||s.sets.length>0)&&e.jsx("div",{className:"rounded-2xl px-1.5 py-0.5 flex items-center justify-center text-white bg-primary text-xs",children:s.tags.length+s.sets.length})]}),e.jsxs(fe,{anchor:"bottom end",className:"flex flex-col w-[400px] bg-white drop-shadow-lg p-6 rounded-md mt-4 z-10",children:[e.jsx("p",{className:"text-md font-semibold mb-4",children:"Filters"}),e.jsx("div",{className:"flex flex-row justify-between w-full pb-2",children:t.annotationSets.length>1&&e.jsxs("div",{className:"w-full pb-2",children:[e.jsxs("div",{className:"flex flex-row justify-between w-full pb-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Annotation Sets"}),s.sets.length>0&&e.jsxs("div",{className:"bg-primary rounded-lg flex items-center justify-center gap-2 py-1 px-2 text-white cursor-default text-xs font-semibold",children:[e.jsx("p",{children:`${s.sets.length} filter${s.sets.length>1?"s":""} applied`}),e.jsx(T,{className:"size-4 text-white hover:scale-105 cursor-pointer",onClick:()=>z("sets",l)})]})]}),t.annotationSets.map(a=>e.jsx("div",{className:"block",children:e.jsxs("div",{className:"flex flex-row gap-3 py-1",children:[e.jsx(L,{checked:s.sets&&s.sets.includes(a.id),onChange:()=>{J(a.id,l)},className:"min-w-4 group size-4 bg-white rounded-sm data-[checked]:bg-primary p-0.5 ring-1 ring-gray-300 ring-inset data-[checked]:ring-primary",children:e.jsx(N,{className:"hidden size-3 group-data-[checked]:block text-white"})}),e.jsx("p",{className:"grow-0 capitalize font-semibold text-xs",children:a.data.set.replaceAll("_","")})]})},a.id))]})}),e.jsxs("div",{className:"flex flex-row justify-between w-full pb-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Tags"}),s.tags.length>0&&e.jsxs("div",{className:"bg-primary rounded-lg flex items-center justify-center gap-2 py-1 px-2 text-white cursor-default text-xs font-semibold",children:[e.jsx("p",{children:`${s.tags.length} filter${s.tags.length>1?"s":""} applied`}),e.jsx(T,{className:"size-4 text-white hover:scale-105 cursor-pointer",onClick:()=>z("tags",l)})]})]}),s&&o.map((a,f)=>e.jsxs(y.Fragment,{children:[f>0?e.jsx("div",{className:"h-[1px] bg-gray-200 w-full my-3"}):null,e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-row gap-3 py-1",children:[e.jsx(L,{checked:s.tags&&s.tags.filter(i=>i.category.toLowerCase()===a.toLowerCase()).length===m[a].tags.length,onChange:()=>{Q(a,m,l)},className:"group size-4 bg-white rounded-sm data-[checked]:bg-primary p-0.5 ring-1 ring-gray-300 ring-inset data-[checked]:ring-primary",children:e.jsx(N,{className:"hidden size-3 group-data-[checked]:block text-white"})}),e.jsx("p",{className:"capitalize font-semibold text-xs",children:a.replaceAll("_","")})]}),e.jsx("div",{className:"flex flex-row gap-2 flex-wrap",children:m[a].tags.map((i,g)=>e.jsx(Ne,{color:m[a].color,tag:i,icon:s.tags&&s.tags?.findIndex(n=>n.category==a&&n.tag==i)!==-1?N:void 0,className:s.tags&&s.tags?.findIndex(n=>n.category===a&&n.tag===i)!==-1?"outline outline-1 outline-black":"",onClick:()=>{Y({category:a,tag:i},l)}},g))})]},f)]},f))]})]})};export{Me as default};
